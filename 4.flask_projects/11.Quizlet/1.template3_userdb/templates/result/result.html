{% extends "base.html" %}

{% block title %}ì‹œí—˜ ê²°ê³¼{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ğŸ“Š ì‹œí—˜ ê²°ê³¼</h2>
    <a href="{{ url_for('quiz.dashboard') }}" class="btn btn-secondary">â† ëŒ€ì‹œë³´ë“œ</a>
</div>

<!-- ì ìˆ˜ ìš”ì•½ -->
<div class="card mb-4">
    <div class="card-header text-center bg-primary text-white">
        <h3>ì±„ì  ê²°ê³¼</h3>
    </div>
    <div class="card-body">
        <div class="row text-center">
            <div class="col-md-3">
                <div class="display-4 {% if score_percentage >= 80 %}text-success{% elif score_percentage >= 60 %}text-warning{% else %}text-danger{% endif %}">
                    {{ score_percentage }}%
                </div>
                <p class="fs-5">ì´ì </p>
            </div>
            <div class="col-md-3">
                <div class="display-6 text-success">{{ correct_count }}</div>
                <p>ì •ë‹µ</p>
            </div>
            <div class="col-md-3">
                <div class="display-6 text-danger">{{ total_questions - correct_count }}</div>
                <p>ì˜¤ë‹µ</p>
            </div>
            <div class="col-md-3">
                <div class="display-6 text-info">{{ total_questions }}</div>
                <p>ì´ ë¬¸ì œ</p>
            </div>
        </div>
        
        <!-- ì„±ê³¼ ë©”ì‹œì§€ -->
        <div class="text-center mt-3">
            {% if score_percentage >= 90 %}
                <div class="alert alert-success">ğŸ‰ í›Œë¥­í•©ë‹ˆë‹¤! ì™„ë²½í•œ ì‹¤ë ¥ì´ë„¤ìš”!</div>
            {% elif score_percentage >= 80 %}
                <div class="alert alert-success">ğŸ‘ ì˜í–ˆìŠµë‹ˆë‹¤! ìš°ìˆ˜í•œ ì„±ê³¼ì…ë‹ˆë‹¤!</div>
            {% elif score_percentage >= 70 %}
                <div class="alert alert-warning">ğŸ‘ ê´œì°®ìŠµë‹ˆë‹¤! ì¡°ê¸ˆ ë” ë…¸ë ¥í•˜ë©´ ë” ì¢‹ì€ ê²°ê³¼ê°€ ìˆì„ ê±°ì˜ˆìš”!</div>
            {% elif score_percentage >= 60 %}
                <div class="alert alert-warning">ğŸ“š ë” ê³µë¶€ê°€ í•„ìš”í•´ìš”. ê³µë¶€ ëª¨ë“œë¥¼ í™œìš©í•´ë³´ì„¸ìš”!</div>
            {% else %}
                <div class="alert alert-danger">ğŸ’ª ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”! ê³µë¶€ ëª¨ë“œë¡œ ë³µìŠµ í›„ ì¬ì‹œí—˜ì„ ì¶”ì²œí•©ë‹ˆë‹¤!</div>
            {% endif %}
        </div>
    </div>
</div>

<!-- ë¬¸ì œë³„ ìƒì„¸ ê²°ê³¼ -->
<div class="mb-4">
    <h4>ğŸ“ ë¬¸ì œë³„ ìƒì„¸ ê²°ê³¼</h4>
</div>

{% for result in results %}
<div class="card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0">ë¬¸ì œ {{ result.question.display_id }}</h6>
        {% if result.is_correct %}
            <span class="badge bg-success fs-6">âœ“ ì •ë‹µ</span>
        {% else %}
            <span class="badge bg-danger fs-6">âœ— ì˜¤ë‹µ</span>
        {% endif %}
    </div>
    <div class="card-body">
        <p class="fw-bold mb-3">{{ result.question.question }}</p>

        {% for choice in result.question.shuffled_choices %}
        <div class="p-2 mb-2 rounded 
            {% if choice.original_index == result.question.answer %}bg-success text-white
            {% elif choice.display_index == result.user_answer and not result.is_correct %}bg-danger text-white
            {% else %}bg-light{% endif %}">
            
            <strong>{{ choice.display_index }}.</strong> {{ choice.text }}
            
            {% if choice.original_index == result.question.answer %}
                <span class="badge bg-warning text-dark ms-2">âœ“ ì •ë‹µ</span>
            {% endif %}
            
            {% if choice.display_index == result.user_answer %}
                <span class="badge bg-info ms-2">ğŸ‘† ë‚´ ì„ íƒ</span>
            {% endif %}
        </div>
        {% endfor %}

        {% if result.question.explanation %}
        <div class="alert alert-info mt-3 mb-0">
            <strong>ğŸ’¬ í•´ì„¤:</strong> {{ result.question.explanation }}
        </div>
        {% endif %}
    </div>
</div>
{% endfor %}

<!-- í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ -->
<div class="d-flex justify-content-center gap-3 mb-5">
    <a href="{{ url_for('result.stats') }}" class="btn btn-info">
        ğŸ“Š í†µê³„ ë³´ê¸°
    </a>
    <a href="{{ url_for('quiz.study', file_id=results[0].question.id if results else '#') }}" class="btn btn-primary">
        ğŸ“– ê³µë¶€ ëª¨ë“œë¡œ
    </a>
    <a href="{{ url_for('quiz.quiz_start', file_id=results[0].question.id if results else '#') }}" class="btn btn-warning">
        ğŸ”„ ë‹¤ì‹œ ì‹œí—˜ë³´ê¸°
    </a>
</div>

<!-- ìŠ¤í¬ë¡¤ í†± ë²„íŠ¼ -->
<button type="button" class="btn btn-primary position-fixed bottom-0 end-0 m-3" 
        onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
        style="z-index: 1000;">
    â†‘ ë§¨ ìœ„ë¡œ
</button>

<script>
// ê²°ê³¼ ì• ë‹ˆë©”ì´ì…˜
document.addEventListener('DOMContentLoaded', function() {
    // ì ìˆ˜ ì¹´ìš´íŠ¸ì—… ì• ë‹ˆë©”ì´ì…˜
    const scoreElement = document.querySelector('.display-4');
    const finalScore = {{ score_percentage }};
    let currentScore = 0;
    const increment = finalScore / 50; // 50 ìŠ¤í…ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜
    
    const countUp = setInterval(function() {
        currentScore += increment;
        if (currentScore >= finalScore) {
            currentScore = finalScore;
            clearInterval(countUp);
        }
        scoreElement.textContent = Math.round(currentScore) + '%';
    }, 20);
});
</script>
{% endblock %}
