{% extends "base.html" %}

{% block title %}ëŒ€ì‹œë³´ë“œ - í€´ì¦ˆ ì•±{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5>ğŸ“ í€´ì¦ˆ íŒŒì¼ ê´€ë¦¬</h5>
                <a href="{{ url_for('quiz.download_template') }}" class="btn btn-outline-success btn-sm">
                    ğŸ“¥ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
                </a>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('quiz.upload_file') }}" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-8">
                            <input type="file" class="form-control" name="file" accept=".xlsx" required>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-primary w-100">ğŸ“¤ ì—…ë¡œë“œ</button>
                        </div>
                    </div>
                    <div class="form-text mt-2">Excel(.xlsx) íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
                </form>
            </div>
        </div>

        <!-- ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ -->
        <div class="card">
            <div class="card-header">
                <h5>ğŸ“š ë‚´ í€´ì¦ˆ íŒŒì¼ ({{ files|length }}ê°œ)</h5>
            </div>
            <div class="card-body">
                {% if files %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>íŒŒì¼ëª…</th>
                                    <th>ë¬¸ì œ ìˆ˜</th>
                                    <th>ì—…ë¡œë“œ ë‚ ì§œ</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for file in files %}
                                <tr>
                                    <td>
                                        <strong>{{ file.original_filename }}</strong>
                                        {% if file.is_public %}
                                            <span class="badge bg-success ms-2">ê³µê°œ</span>
                                        {% else %}
                                            <span class="badge bg-secondary ms-2">ë¹„ê³µê°œ</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ file.question_count }}ë¬¸ì œ</span>
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ file.created_at }}</small>
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <a href="{{ url_for('quiz.study', file_id=file.id) }}" 
                                               class="btn btn-outline-info">ğŸ“– ê³µë¶€</a>
                                            <a href="{{ url_for('quiz.quiz_start', file_id=file.id) }}" 
                                               class="btn btn-outline-warning">ğŸ¯ ì‹œí—˜</a>
                                            <form method="POST" action="{{ url_for('quiz.toggle_share', file_id=file.id) }}" style="display:inline-block;">
                                                {% if file.is_public %}
                                                <input type="hidden" name="is_public" value="0">
                                                <button type="submit" class="btn btn-outline-secondary">ğŸ”’ ë¹„ê³µê°œ</button>
                                                {% else %}
                                                <input type="hidden" name="is_public" value="1">
                                                <button type="submit" class="btn btn-outline-success">ğŸ”“ ê³µê°œ</button>
                                                {% endif %}
                                            </form>
                                            <form method="POST" action="{{ url_for('quiz.delete_file', file_id=file.id) }}" 
                                                  style="display: inline;" 
                                                  onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
                                                <button type="submit" class="btn btn-outline-danger">ğŸ—‘ï¸</button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <p class="text-muted">ì•„ì§ ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë¬¸ì œë¥¼ ì‘ì„±í•˜ê³  ì—…ë¡œë“œí•´ë³´ì„¸ìš”!</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="col-md-4">
        <!-- ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ -->
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h6>ğŸš€ ë¹ ë¥¸ ì‹œì‘</h6>
            </div>
            <div class="card-body">
                <ol class="list-unstyled">
                    <li>1ï¸âƒ£ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</li>
                    <li>2ï¸âƒ£ ë¬¸ì œ ì‘ì„±</li>
                    <li>3ï¸âƒ£ íŒŒì¼ ì—…ë¡œë“œ</li>
                    <li>4ï¸âƒ£ ê³µë¶€/ì‹œí—˜ ëª¨ë“œ ì„ íƒ</li>
                </ol>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('quiz.settings') }}" class="btn btn-outline-secondary btn-sm">âš™ï¸ ì„¤ì •</a>
                    <a href="{{ url_for('result.stats') }}" class="btn btn-outline-primary btn-sm">ğŸ“Š í†µê³„</a>
                </div>
            </div>
        </div>

        <!-- ìµœê·¼ ì‹œí—˜ ê²°ê³¼ -->
        {% if recent_results %}
        <div class="card">
            <div class="card-header bg-light">
                <h6>ğŸ“ˆ ìµœê·¼ ì‹œí—˜ ê²°ê³¼</h6>
            </div>
            <div class="card-body">
                {% for result in recent_results %}
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <small class="text-muted">{{ result.original_filename }}</small>
                        <br>
                        <small class="text-muted">{{ result.created_at }}</small>
                    </div>
                    <div>
                        <span class="badge {% if result.score >= 80 %}bg-success{% elif result.score >= 60 %}bg-warning{% else %}bg-danger{% endif %}">
                            {{ result.score }}%
                        </span>
                    </div>
                </div>
                {% if not loop.last %}<hr class="my-2">{% endif %}
                {% endfor %}
                <div class="d-grid mt-3">
                    <a href="{{ url_for('result.history') }}" class="btn btn-outline-primary btn-sm">ì „ì²´ ë³´ê¸°</a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
