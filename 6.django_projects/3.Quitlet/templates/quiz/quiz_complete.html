<!-- templates/quiz/quiz_complete.html -->
{% extends 'base/base.html' %}
{% load quiz_extras %}

{% block title %}í€´ì¦ˆ ì™„ë£Œ - {{ quiz.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <!-- ê²°ê³¼ ìš”ì•½ -->
        <div class="card mb-4">
            <div class="card-header text-center bg-primary text-white">
                <h3>í€´ì¦ˆ ì™„ë£Œ!</h3>
            </div>
            <div class="card-body text-center">
                <div class="row">
                    <div class="col-md-3">
                        <div class="score-display">
                            <h2 class="display-4 text-primary">{{ percentage }}%</h2>
                            <p class="text-muted">ì´ì </p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="score-detail">
                            <h4 class="text-success">{{ correct_count }}</h4>
                            <p class="text-muted">ì •ë‹µ</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="score-detail">
                            <h4 class="text-danger">{{ wrong_count }}</h4>
                            <p class="text-muted">ì˜¤ë‹µ</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="score-detail">
                            <h4 class="text-info">{{ quiz.total_questions }}</h4>
                            <p class="text-muted">ì´ ë¬¸ì œ</p>
                        </div>
                    </div>
                </div>
                
                {% if quiz.time_taken %}
                <div class="mt-3">
                    <p><strong>ì†Œìš” ì‹œê°„:</strong> 
                        {% if quiz.time_taken.seconds >= 3600 %}
                            {% widthratio quiz.time_taken.total_seconds 3600 1 %}ì‹œê°„ 
                        {% endif %}
                        {{ quiz.time_taken.seconds|floatformat:0|mod:3600|div:60 }}ë¶„ 
                        {{ quiz.time_taken.seconds|mod:60 }}ì´ˆ
                    </p>
                </div>
                {% endif %}
                
                <!-- ì„±ê³¼ ë©”ì‹œì§€ -->
                <div class="achievement mt-3">
                    {% if percentage >= 90 %}
                        <div class="alert alert-success">
                            <h5>ğŸ‰ ìš°ìˆ˜í•œ ì„±ê³¼ì…ë‹ˆë‹¤!</h5>
                            <p>90ì  ì´ìƒì˜ í›Œë¥­í•œ ì ìˆ˜ë¥¼ ë°›ìœ¼ì…¨ìŠµë‹ˆë‹¤!</p>
                        </div>
                    {% elif percentage >= 70 %}
                        <div class="alert alert-info">
                            <h5>ğŸ‘ ì¢‹ì€ ì„±ê³¼ì…ë‹ˆë‹¤!</h5>
                            <p>70ì  ì´ìƒì˜ ì¢‹ì€ ì ìˆ˜ì…ë‹ˆë‹¤. ì¡°ê¸ˆ ë” ê³µë¶€í•˜ë©´ ë” ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”!</p>
                        </div>
                    {% elif percentage >= 50 %}
                        <div class="alert alert-warning">
                            <h5>ğŸ“š ë” ì—´ì‹¬íˆ ê³µë¶€í•´ë³´ì„¸ìš”!</h5>
                            <p>ê¸°ë³¸ê¸°ëŠ” ê°–ì¶”ì—ˆì§€ë§Œ ë” ë§ì€ ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        </div>
                    {% else %}
                        <div class="alert alert-danger">
                            <h5>ğŸ’ª ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!</h5>
                            <p>ì¡°ê¸ˆ ë” ê³µë¶€í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ìƒì„¸ ê²°ê³¼ -->
        <div class="card">
            <div class="card-header">
                <h5>ìƒì„¸ ê²°ê³¼</h5>
            </div>
            <div class="card-body">
                {% for result in results %}
                <div class="result-item mb-4 p-3 border rounded">
                    <div class="d-flex justify-content-between align-items-start">
                        <h6>ë¬¸ì œ {{ forloop.counter }}</h6>
                        {% if result.is_correct %}
                            <span class="badge bg-success">ì •ë‹µ</span>
                        {% else %}
                            <span class="badge bg-danger">ì˜¤ë‹µ</span>
                        {% endif %}
                    </div>
                    
                    <p class="question-text mt-2">{{ result.question.question_text }}</p>
                    
                    <div class="choices-review">
                        {% for choice in result.question.choices.all %}
                        <div class="choice-review mb-1 p-2 rounded
                                    {% if choice.is_correct %}bg-success text-white
                                    {% elif choice == result.selected_choice and not choice.is_correct %}bg-danger text-white
                                    {% elif choice == result.selected_choice %}bg-primary text-white
                                    {% else %}bg-light{% endif %}">
                            <span class="fw-bold">{{ forloop.counter }}.</span> {{ choice.choice_text }}
                            {% if choice.is_correct %}
                                <span class="badge bg-warning text-dark ms-2">ì •ë‹µ</span>
                            {% endif %}
                            {% if choice == result.selected_choice %}
                                <span class="badge bg-info ms-2">ì„ íƒ</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    
                    {% if result.question.explanation %}
                    <div class="explanation mt-3">
                        <strong>í•´ì„¤:</strong> {{ result.question.explanation }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="text-center mt-4 mb-4">
            <a href="{% url 'quiz:question_set_detail' quiz.question_set.pk %}" class="btn btn-primary">
                ë¬¸ì œì§‘ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </a>
            <a href="{% url 'quiz:quiz_start' quiz.question_set.pk %}" class="btn btn-success">
                ë‹¤ì‹œ ë„ì „í•˜ê¸°
            </a>
            <a href="{% url 'quiz:my_quizzes' %}" class="btn btn-info">
                ë‚´ í€´ì¦ˆ ê¸°ë¡ ë³´ê¸°
            </a>
            <a href="{% url 'quiz:question_list' %}" class="btn btn-secondary">
                ë‹¤ë¥¸ ë¬¸ì œì§‘ ë³´ê¸°
            </a>
        </div>
    </div>
</div>

<style>
.score-display .display-4 {
    font-weight: bold;
}

.score-detail h4 {
    font-weight: bold;
    margin-bottom: 0;
}

.result-item {
    border-left: 4px solid #007bff;
}

.choice-review {
    transition: all 0.2s ease;
}

.achievement {
    border-radius: 10px;
}

@media (max-width: 768px) {
    .score-display .display-4 {
        font-size: 2.5rem;
    }
    
    .score-detail h4 {
        font-size: 1.5rem;
    }
}
</style>
{% endblock %}
